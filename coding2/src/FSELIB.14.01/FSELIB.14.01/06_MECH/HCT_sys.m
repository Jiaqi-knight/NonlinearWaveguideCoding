function [a] = HCT_sys (x1,y1, x2,y2, x3,y3, dof)

%=================================================
% Generate the modal (dof) polynomial coefficients
% for the HCT element
%
% dof: degrees of freedom
%==================================================

%------
% midside nodes and normal vectors
%-------

x4=0.5*(x1+x2); y4=0.5*(y1+y2);
d4=sqrt((x2-x1)^2+(y2-y1)^2);
nx4=-(y2-y1)/d4; ny4=(x2-x1)/d4;

x5=0.5*(x2+x3); y5=0.5*(y2+y3);
d5=sqrt((x3-x2)^2+(y3-y2)^2);
nx5=-(y3-y2)/d5; ny5=(x3-x2)/d5;

x6 = 0.5*(x3+x1); y6=0.5*(y3+y1);
d6=sqrt((x1-x3)^2+(y1-y3)^2);
nx6=-(y1-y3)/d6; ny6=(x1-x3)/d6;

%--------------
% interior node
%--------------

x7=(x1+x2+x3)/3.0;
y7=(y1+y2+y3)/3.0;

%------
% interior midside nodes and normal vectors
%-------

x8 = 0.5*(x1+x7); y8=0.5*(y1+y7);
d8 = sqrt((x7-x1)^2+(y7-y1)^2);
nx8=-(y7-y1)/d8; ny8=(x7-x1)/d8;

x9 = 0.5*(x2+x7); y9=0.5*(y2+y7);
d9 = sqrt((x7-x2)^2+(y7-y2)^2);
nx9=-(y7-y2)/d9; ny9=(x7-x2)/d9;

x10 = 0.5*(x3+x7); y10=0.5*(y3+y7);
d10 = sqrt((x7-x3)^2+(y7-y3)^2);
nx10=-(y7-y3)/d10; ny10=(x7-x3)/d10;

%--------
% define the coefficient matrix
%--------

D = [ ...
   % first sub-element: (6 eqns)
...
1  x1  y1  x1^2  x1*y1  y1^2  x1^3  x1^2*y1  x1*y1^2  y1^3 ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ... 
...
0  1  0  2*x1  y1  0  3*x1^2  2*x1*y1  y1^2  0   ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ... 
...
0  0  1  0  x1  2*y1  0  x1^2  2*x1*y1  3*y1^2 ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ... 
...
1  x2  y2  x2^2  x2*y2  y2^2  x2^3  x2^2*y2  x2*y2^2  y2^3 ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ... 
...
0  1  0  2*x2  y2  0  3*x2^2  2*x2*y2  y2^2  0   ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ... 
...
0  0  1  0  x2  2*y2  0  x2^2  2*x2*y2  3*y2^2 ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ...
...
   % second sub-element: (6 eqns)
...
0 0 0 0 0 0 0 0 0 0 ...
1  x2  y2  x2^2  x2*y2  y2^2  x2^3  x2^2*y2  x2*y2^2  y2^3 ...
0 0 0 0 0 0 0 0 0 0 ; ...
0 0 0 0 0 0 0 0 0 0 ...
0  1  0  2*x2  y2  0  3*x2^2  2*x2*y2  y2^2  0   ...
0 0 0 0 0 0 0 0 0 0 ; ...
0 0 0 0 0 0 0 0 0 0 ...
0  0  1  0  x2  2*y2  0  x2^2  2*x2*y2  3*y2^2 ...
0 0 0 0 0 0 0 0 0 0 ; ...
...
0 0 0 0 0 0 0 0 0 0 ...
1  x3  y3  x3^2  x3*y3  y3^2  x3^3  x3^2*y3  x3*y3^2  y3^3   ...
0 0 0 0 0 0 0 0 0 0 ; ...
0 0 0 0 0 0 0 0 0 0 ...
0 1 0 2*x3 y3 0  3*x3^2  2*x3*y3  y3^2   0   ...
0 0 0 0 0 0 0 0 0 0 ; ...
0 0 0 0 0 0 0 0 0 0 ...
0  0  1  0  x3  2*y3  0  x3^2  2*x3*y3  3*y3^2 ...
0 0 0 0 0 0 0 0 0 0 ; ...
...
  % third sub-element: (6 eqns)
...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
1  x3  y3  x3^2  x3*y3  y3^2  x3^3  x3^2*y3  x3*y3^2  y3^3 ; ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
0  1  0  2*x3  y3     0  3*x3^2  2*x3*y3   y3^2  0 ; ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
0  0  1  0  x3  2*y3  0  x3^2  2*x3*y3  3*y3^2 ; ...
...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
1  x1  y1  x1^2  x1*y1  y1^2  x1^3  x1^2*y1  x1*y1^2  y1^3 ; ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
0  1  0  2*x1   y1  0  3*x1^2  2*x1*y1  y1^2   0 ; ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
0  0  1  0      x1  2*y1  0  x1^2  2*x1*y1  3*y1^2 ; ...
...
   % midside node 4: (1 eqn)
...
0  nx4  ny4  2*x4*nx4  y4*nx4+x4*ny4  2*y4*ny4  ...
 3*x4^2*nx4  x4*(2*y4*nx4+x4*ny4)  y4*(y4*nx4+2*x4*ny4)  3*y4^2*ny4  ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ;
...
   % midside node 5: (1 eqn)
...
0 0 0 0 0 0 0 0 0 0 ...
0  nx5  ny5  2*x5*nx5  y5*nx5+x5*ny5  2*y5*ny5  ...
 3*x5^2*nx5  x5*(2*y5*nx5+x5*ny5)  y5*(y5*nx5+2*x5*ny5)  3*y5^2*ny5  ...
0 0 0 0 0 0 0 0 0 0 ; ...
...
   % midside node 6: (1 eqn)
...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ...
0  nx6  ny6  2*x6*nx6  y6*nx6+x6*ny6  2*y6*ny6  ...
 3*x6^2*nx6  x6*(2*y6*nx6+x6*ny6)  y6*(y6*nx6+2*x6*ny6)  3*y6^2*ny6; ...
...
  % continuity at interior node 7 for sub-elements 1 and 2:  (3 eqns)
...
 1  x7  y7  x7^2  x7*y7  y7^2  x7^3  x7^2*y7  x7*y7^2  y7^3  ...
-1 -x7 -y7 -x7^2 -x7*y7 -y7^2 -x7^3 -x7^2*y7 -x7*y7^2 -y7^3  ...
0 0 0 0 0 0 0 0 0 0 ; ...
...
0  1  0  2*x7  y7  0  3*x7^2  2*x7*y7  y7^2  0  ...
0 -1  0 -2*x7 -y7  0 -3*x7^2 -2*x7*y7 -y7^2  0  ...
0 0 0 0 0 0 0 0 0 0 ; ...
...
0  0  1  0  x7  2*y7  0  x7^2  2*x7*y7  3*y7^2 ...
0  0 -1  0 -x7 -2*y7  0 -x7^2 -2*x7*y7 -3*y7^2 ...
0 0 0 0 0 0 0 0 0 0 ; ...
...
   % continuity at interior node 7 for sub-elements 2 and 3: (3 eqns)
...
0 0 0 0 0 0 0 0 0 0 ... 
 1  x7  y7  x7^2  x7*y7  y7^2  x7^3  x7^2*y7  x7*y7^2  y7^3   ...
-1 -x7 -y7 -x7^2 -x7*y7 -y7^2 -x7^3 -x7^2*y7 -x7*y7^2 -y7^3 ;  ...
...
0 0 0 0 0 0 0 0 0 0 ... 
0  1  0  2*x7  y7  0  3*x7^2  2*x7*y7  y7^2  0  ...
0 -1  0 -2*x7 -y7  0 -3*x7^2 -2*x7*y7 -y7^2  0 ;
...
0 0 0 0 0 0 0 0 0 0 ... 
0  0  1  0  x7  2*y7 0  x7^2  2*x7*y7  3*y7^2 ...
0  0 -1  0 -x7 -2*y7 0 -x7^2 -2*x7*y7 -3*y7^2 ;
...
   % continuity of normal derivative at midside node 8: (1 eqn)
...
0  nx8  ny8  2*x8*nx8  y8*nx8+x8*ny8  2*y8*ny8  ...
   3*x8^2*nx8  x8*(2*y8*nx8+x8*ny8)  y8*(y8*nx8+2*x8*ny8) ...
   3*y8^2*ny8  ...
0 0 0 0 0 0 0 0 0 0 ... 
0 -nx8 -ny8 -2*x8*nx8 -y8*nx8-x8*ny8 -2*y8*ny8 ...
  -3*x8^2*nx8 -x8*(2*y8*nx8+x8*ny8) -y8*(y8*nx8+2*x8*ny8) ...
  -3*y8^2*ny8 ;...
...
   % continuity of normal derivative at midside node 9: (1 eqn)
...
0  nx9  ny9  2*x9*nx9  y9*nx9+x9*ny9  2*y9*ny9  ...
   3*x9^2*nx9  x9*(2*y9*nx9+x9*ny9)  y9*(y9*nx9+2*x9*ny9) ...
   3*y9^2*ny9 ...
0 -nx9 -ny9 -2*x9*nx9 -y9*nx9-x9*ny9 -2*y9*ny9  ...
  -3*x9^2*nx9 -x9*(2*y9*nx9+x9*ny9) -y9*(y9*nx9+2*x9*ny9) ...
  -3*y9^2*ny9 ...
0 0 0 0 0 0 0 0 0 0 ; ... 
...
   % continuity of normal derivative at midside node 10: (1 eqn)
...
0 0 0 0 0 0 0 0 0 0 ... 
0  nx10  ny10  2*x10*nx10  y10*nx10+x10*ny10  2*y10*ny10  ...
   3*x10^2*nx10  x10*(2*y10*nx10+x10*ny10)  y10*(y10*nx10+2*x10*ny10) ...
   3*y10^2*ny10 ...
0 -nx10 -ny10 -2*x10*nx10 -y10*nx10-x10*ny10 -2*y10*ny10  ...
  -3*x10^2*nx10 -x10*(2*y10*nx10+x10*ny10) -y10*(y10*nx10+2*x10*ny10) ...
  -3*y10^2*ny10  ;
];

%--------
% define the right-hand side
%--------

b=zeros(1,30);
b(1)  = dof(1);  b(2)  = dof(2);  b(3)  = dof(3);
b(4)  = dof(4);  b(5)  = dof(5);  b(6)  = dof(6);
b(7)  = dof(4);  b(8)  = dof(5);  b(9)  = dof(6);
b(10) = dof(7);  b(11) = dof(8);  b(12) = dof(9);
b(13) = dof(7);  b(14) = dof(8);  b(15) = dof(9);
b(16) = dof(1);  b(17) = dof(2);  b(18) = dof(3);
b(19) = dof(10); b(20) = dof(11); b(21) = dof(12);

%--------------------
% solve the linear system
%--------------------

a = b/D';

return
